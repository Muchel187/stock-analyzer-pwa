<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Pers√∂nliches Aktienanalyse- und Portfolio-Management-Tool">
    <meta name="theme-color" content="#2c3e50">

    <title>Stock Analyzer - Portfolio & Aktienanalyse</title>

    <!-- PWA Meta Tags -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Stock Analyzer">

    <!-- Icons -->
    <link rel="icon" type="image/png" href="/static/images/icon-192.png">
    <link rel="apple-touch-icon" href="/static/images/icon-192.png">

    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/ai-analysis.css">

    <!-- Chart.js f√ºr Diagramme -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <span class="nav-logo">üìà</span>
                <span class="nav-title">Stock Analyzer</span>
            </div>

            <div class="nav-menu" id="navMenu">
                <a href="#dashboard" class="nav-link active" data-page="dashboard">Dashboard</a>
                <a href="#portfolio" class="nav-link" data-page="portfolio">Portfolio</a>
                <a href="#watchlist" class="nav-link" data-page="watchlist">Watchlist</a>
                <a href="#screener" class="nav-link" data-page="screener">Screener</a>
                <a href="#alerts" class="nav-link" data-page="alerts">Alerts</a>
                <a href="#analysis" class="nav-link" data-page="analysis">Analyse</a>
            </div>

            <div class="nav-user">
                <span id="userDisplay" class="user-display" style="display:none;">
                    <span id="username"></span>
                    <button class="btn btn-sm btn-outline" onclick="app.logout()">Logout</button>
                </span>
                <button id="loginBtn" class="btn btn-primary btn-sm" onclick="app.showLogin()">Login</button>
            </div>

            <button class="nav-toggle" id="navToggle">‚ò∞</button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="app-container">
        <!-- Dashboard Page -->
        <div id="dashboard-page" class="page active">
            <div class="page-header">
                <h1>Dashboard</h1>
                <button class="btn btn-icon" onclick="app.customizeDashboard()" title="Dashboard anpassen">‚öôÔ∏è</button>
            </div>

            <div class="dashboard-grid" id="dashboardGrid">
                <!-- Portfolio Widget -->
                <div class="widget" id="portfolioWidget">
                    <div class="widget-header">
                        <h3>Portfolio Performance</h3>
                        <span class="widget-actions">
                            <button class="btn-icon" onclick="app.refreshPortfolio()">üîÑ</button>
                        </span>
                    </div>
                    <div class="widget-body">
                        <div id="portfolioSummary" class="loading">
                            <div class="metric-group">
                                <div class="metric">
                                    <span class="metric-label">Gesamtwert</span>
                                    <span class="metric-value" id="totalValue">-</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Tagesperformance</span>
                                    <span class="metric-value" id="dayPerformance">-</span>
                                </div>
                                <div class="metric">
                                    <span class="metric-label">Gesamtrendite</span>
                                    <span class="metric-value" id="totalReturn">-</span>
                                </div>
                            </div>
                            <canvas id="portfolioChart" style="display:none;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Watchlist Widget -->
                <div class="widget" id="watchlistWidget">
                    <div class="widget-header">
                        <h3>Watchlist</h3>
                        <span class="widget-actions">
                            <button class="btn-icon" onclick="app.addToWatchlist()">‚ûï</button>
                        </span>
                    </div>
                    <div class="widget-body">
                        <div id="watchlistItems" class="watchlist-items loading">
                            <!-- Watchlist items werden hier eingef√ºgt -->
                        </div>
                    </div>
                </div>

                <!-- Recommendations Widget -->
                <div class="widget" id="recommendationsWidget">
                    <div class="widget-header">
                        <h3>Top Empfehlungen</h3>
                        <span class="widget-actions">
                            <button class="btn-icon" onclick="app.refreshRecommendations()">üîÑ</button>
                        </span>
                    </div>
                    <div class="widget-body">
                        <div id="recommendationsList" class="recommendations loading">
                            <!-- Empfehlungen werden hier eingef√ºgt -->
                        </div>
                    </div>
                </div>

                <!-- AI Market Analysis Widget -->
                <div class="widget widget-full" id="aiRecommendationsWidget">
                    <div class="widget-header">
                        <h3>ü§ñ KI-Marktanalyse: Top Kauf/Verkaufsempfehlungen</h3>
                        <span class="widget-actions">
                            <span class="widget-subtitle">US & Deutscher Markt</span>
                            <button class="btn btn-primary btn-sm" id="aiRefreshBtn" onclick="app.refreshAIRecommendations()">
                                <span id="aiRefreshIcon">üîÑ</span>
                                <span id="aiRefreshText">Aktualisieren</span>
                            </button>
                        </span>
                    </div>
                    <div class="widget-body">
                        <div id="aiRecommendationsContent">
                            <div class="ai-recs-placeholder">
                                <div class="placeholder-icon">ü§ñ</div>
                                <p>Klicken Sie auf "Aktualisieren", um KI-gest√ºtzte Marktempfehlungen zu erhalten</p>
                                <p class="placeholder-note">Die Analyse umfasst Top-Aktien aus dem US- und deutschen Markt</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alerts Widget -->
                <div class="widget" id="alertsWidget">
                    <div class="widget-header">
                        <h3>Aktive Alerts</h3>
                        <span class="widget-actions">
                            <span class="badge" id="alertCount">0</span>
                        </span>
                    </div>
                    <div class="widget-body">
                        <div id="activeAlerts" class="alerts-list loading">
                            <!-- Alerts werden hier eingef√ºgt -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio Page -->
        <div id="portfolio-page" class="page">
            <div class="page-header">
                <h1>Portfolio</h1>
                <button class="btn btn-primary" onclick="app.showAddTransaction()">+ Transaktion</button>
            </div>

            <div class="portfolio-container">
                <div class="portfolio-summary card">
                    <h3>Portfolio √úbersicht</h3>
                    <div id="portfolioDetailSummary">
                        <!-- Portfolio Details -->
                    </div>
                </div>

                <div class="portfolio-holdings card">
                    <h3>Positionen</h3>
                    <div id="portfolioHoldings">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Name</th>
                                    <th>Anteile</th>
                                    <th>Kurs</th>
                                    <th>Wert</th>
                                    <th>Performance</th>
                                    <th>Aktionen</th>
                                </tr>
                            </thead>
                            <tbody id="portfolioTableBody">
                                <!-- Portfolio Positionen -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="portfolio-chart card">
                    <h3>Diversifikation</h3>
                    <canvas id="diversificationChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Watchlist Page -->
        <div id="watchlist-page" class="page">
            <div class="page-header">
                <h1>Watchlist</h1>
                <button class="btn btn-primary" onclick="app.showAddToWatchlist()">+ Aktie hinzuf√ºgen</button>
            </div>

            <div class="watchlist-container">
                <div class="watchlist-grid" id="watchlistGrid">
                    <!-- Watchlist Cards -->
                </div>
            </div>
        </div>

        <!-- Screener Page -->
        <div id="screener-page" class="page">
            <div class="page-header">
                <h1>Stock Screener</h1>
                <button class="btn btn-outline" onclick="app.resetScreener()">Filter zur√ºcksetzen</button>
            </div>

            <div class="screener-container">
                <div class="screener-filters card">
                    <h3>Filter</h3>
                    <form id="screenerForm" class="filter-form">
                        <div class="filter-group">
                            <label>Markt</label>
                            <select id="marketFilter">
                                <option value="USA">USA</option>
                                <option value="DAX">DAX</option>
                                <option value="ALL">Alle</option>
                            </select>
                        </div>

                        <div class="filter-group">
                            <label>Market Cap (Min)</label>
                            <input type="number" id="minMarketCap" placeholder="z.B. 1000000000">
                        </div>

                        <div class="filter-group">
                            <label>P/E Ratio</label>
                            <div class="range-inputs">
                                <input type="number" id="minPE" placeholder="Min" step="0.1">
                                <input type="number" id="maxPE" placeholder="Max" step="0.1">
                            </div>
                        </div>

                        <div class="filter-group">
                            <label>Dividendenrendite (Min %)</label>
                            <input type="number" id="minDividend" placeholder="z.B. 2" step="0.1">
                        </div>

                        <div class="filter-group">
                            <label>Strategien</label>
                            <div class="checkbox-group">
                                <label><input type="checkbox" id="preferValue"> Value</label>
                                <label><input type="checkbox" id="preferGrowth"> Growth</label>
                                <label><input type="checkbox" id="preferDividends"> Dividenden</label>
                                <label><input type="checkbox" id="preferMomentum"> Momentum</label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block">Suchen</button>
                    </form>

                    <div class="preset-strategies">
                        <h4>Vorgefertigte Strategien</h4>
                        <div id="presetStrategies" class="preset-buttons">
                            <!-- Preset Buttons -->
                        </div>
                    </div>
                </div>

                <div class="screener-results card">
                    <h3>Ergebnisse <span id="resultCount"></span></h3>
                    <div id="screenerResults">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>Name</th>
                                    <th>Kurs</th>
                                    <th>Market Cap</th>
                                    <th>P/E</th>
                                    <th>Dividende</th>
                                    <th>Score</th>
                                    <th>Aktion</th>
                                </tr>
                            </thead>
                            <tbody id="screenerTableBody">
                                <!-- Ergebnisse -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Page -->
        <div id="alerts-page" class="page">
            <div class="page-header">
                <h1>Preis-Alerts</h1>
                <button class="btn btn-primary" onclick="app.showCreateAlert()">+ Alert erstellen</button>
            </div>

            <div class="alerts-container">
                <div class="alerts-stats card">
                    <h3>Alert Statistiken</h3>
                    <div id="alertStats" class="stats-grid">
                        <!-- Statistiken -->
                    </div>
                </div>

                <div class="alerts-list-container card">
                    <h3>Meine Alerts</h3>
                    <div class="alert-tabs">
                        <button class="tab-btn active" data-tab="active">Aktiv</button>
                        <button class="tab-btn" data-tab="triggered">Ausgel√∂st</button>
                        <button class="tab-btn" data-tab="all">Alle</button>
                    </div>
                    <div id="alertsList" class="alerts-grid">
                        <!-- Alerts -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Page -->
        <div id="analysis-page" class="page">
            <div class="page-header">
                <h1>Aktienanalyse</h1>
            </div>

            <div class="analysis-container">
                <div class="search-box card">
                    <input type="text" id="stockSearch" class="search-input" placeholder="Symbol eingeben (z.B. AAPL, MSFT)...">
                    <button class="btn btn-primary" onclick="app.analyzeStock()">Analysieren</button>
                </div>

                <div id="analysisResult" style="display:none;">
                    <div class="stock-header card">
                        <h2 id="stockName"></h2>
                        <div id="stockPrice" class="price-display"></div>
                    </div>

                    <div class="analysis-tabs card">
                        <div class="tab-buttons">
                            <button class="tab-btn active" data-analysis-tab="overview">√úbersicht</button>
                            <button class="tab-btn" data-analysis-tab="technical">Technisch</button>
                            <button class="tab-btn" data-analysis-tab="fundamental">Fundamental</button>
                            <button class="tab-btn" data-analysis-tab="ai">KI-Analyse</button>
                            <button class="tab-btn" data-analysis-tab="compare">Vergleich</button>
                        </div>

                        <div class="tab-content">
                            <div id="overview-tab" class="tab-pane active">
                                <!-- √úbersicht -->
                            </div>
                            <div id="technical-tab" class="tab-pane">
                                <!-- Technische Analyse -->
                            </div>
                            <div id="fundamental-tab" class="tab-pane">
                                <!-- Fundamentalanalyse -->
                            </div>
                            <div id="ai-tab" class="tab-pane">
                                <!-- KI-Analyse -->
                            </div>
                            <div id="compare-tab" class="tab-pane">
                                <!-- Aktienvergleich -->
                                <div class="compare-container">
                                    <div class="compare-header">
                                        <h3>Aktien vergleichen</h3>
                                        <p class="text-secondary">Vergleichen Sie 2-4 Aktien direkt miteinander</p>
                                    </div>

                                    <div class="compare-input-section">
                                        <div class="compare-ticker-inputs">
                                            <input type="text" id="compareTicker1" class="compare-ticker-input" placeholder="Ticker 1 (z.B. AAPL)">
                                            <input type="text" id="compareTicker2" class="compare-ticker-input" placeholder="Ticker 2 (z.B. MSFT)">
                                            <input type="text" id="compareTicker3" class="compare-ticker-input" placeholder="Ticker 3 (optional)">
                                            <input type="text" id="compareTicker4" class="compare-ticker-input" placeholder="Ticker 4 (optional)">
                                        </div>
                                        
                                        <div class="compare-period-selector">
                                            <label>Zeitraum:</label>
                                            <select id="comparePeriod" class="period-select">
                                                <option value="1mo">1 Monat</option>
                                                <option value="3mo">3 Monate</option>
                                                <option value="6mo">6 Monate</option>
                                                <option value="1y" selected>1 Jahr</option>
                                                <option value="2y">2 Jahre</option>
                                                <option value="5y">5 Jahre</option>
                                            </select>
                                        </div>

                                        <button class="btn btn-primary" onclick="app.runComparison()">
                                            <span>üîç</span> Vergleichen
                                        </button>
                                    </div>

                                    <div id="compareResults" class="compare-results" style="display:none;">
                                        <!-- Comparison Table -->
                                        <div class="compare-metrics-table card">
                                            <h4>üìä Kennzahlen-Vergleich</h4>
                                            <div id="compareTable"></div>
                                        </div>

                                        <!-- Normalized Price Chart -->
                                        <div class="compare-chart-card card">
                                            <h4>üìà Normalisierte Kursentwicklung (% √Ñnderung)</h4>
                                            <canvas id="compareChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-container card">
                        <div class="chart-header">
                            <h3>üìà Kursverlauf</h3>
                            <div class="chart-controls">
                                <div class="period-buttons">
                                    <button class="period-btn" data-period="1mo" onclick="app.changePricePeriod('1mo')">1M</button>
                                    <button class="period-btn" data-period="3mo" onclick="app.changePricePeriod('3mo')">3M</button>
                                    <button class="period-btn" data-period="6mo" onclick="app.changePricePeriod('6mo')">6M</button>
                                    <button class="period-btn active" data-period="1y" onclick="app.changePricePeriod('1y')">1J</button>
                                    <button class="period-btn" data-period="2y" onclick="app.changePricePeriod('2y')">2J</button>
                                    <button class="period-btn" data-period="5y" onclick="app.changePricePeriod('5y')">5J</button>
                                    <button class="period-btn" data-period="max" onclick="app.changePricePeriod('max')">Max</button>
                                </div>
                                <div class="chart-toggles">
                                    <label class="toggle-label">
                                        <input type="checkbox" id="toggleSMA50" onchange="app.toggleMovingAverage('sma50')">
                                        <span>SMA 50</span>
                                    </label>
                                    <label class="toggle-label">
                                        <input type="checkbox" id="toggleSMA200" onchange="app.toggleMovingAverage('sma200')">
                                        <span>SMA 200</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <canvas id="priceChart"></canvas>
                        
                        <div class="volume-chart-container">
                            <h4>üìä Handelsvolumen</h4>
                            <canvas id="volumeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="modalOverlay" class="modal-overlay" style="display:none;"></div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Anmelden</h2>
                <button class="close-btn" onclick="app.closeModal('loginModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label>E-Mail oder Benutzername</label>
                        <input type="text" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Passwort</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Anmelden</button>
                </form>
                <div class="modal-footer">
                    <p>Noch kein Konto? <a href="#" onclick="app.showRegister()">Registrieren</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Registrieren</h2>
                <button class="close-btn" onclick="app.closeModal('registerModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label>E-Mail</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Benutzername</label>
                        <input type="text" id="registerUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Passwort</label>
                        <input type="password" id="registerPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Registrieren</button>
                </form>
                <div class="modal-footer">
                    <p>Bereits registriert? <a href="#" onclick="app.showLogin()">Anmelden</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Modal -->
    <div id="alertModal" class="modal" style="display:none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Preis-Alert erstellen</h2>
                <button class="close-btn" onclick="app.closeModal('alertModal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="alertForm">
                    <div class="form-group">
                        <label>Ticker Symbol</label>
                        <input type="text" id="alertTicker" required placeholder="z.B. AAPL" style="text-transform: uppercase;">
                    </div>
                    <div class="form-group">
                        <label>Alert Typ</label>
                        <select id="alertCondition" required>
                            <option value="above">Preis √ºber</option>
                            <option value="below">Preis unter</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Zielpreis ($)</label>
                        <input type="number" id="alertTargetPrice" required step="0.01" min="0" placeholder="z.B. 150.00">
                    </div>
                    <div class="form-group">
                        <label>Notiz (optional)</label>
                        <textarea id="alertNote" rows="3" placeholder="Notizen zu diesem Alert..."></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Alert erstellen</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Scripts -->
    <script src="/static/js/api.js"></script>
    <script src="/static/js/components.js"></script>
    <script src="/static/js/charts.js"></script>
    <script src="/static/js/ai-analysis.js"></script>
    <script src="/static/js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => console.log('Service Worker registered'))
                    .catch(error => console.error('Service Worker registration failed:', error));
            });
        }
    </script>

    <!-- Theme Manager -->
    <script src="/static/js/theme-manager.js"></script>
    
    <!-- Market Status Widget -->
    <script src="/static/js/market-status.js"></script>
    
    <!-- Export Manager -->
    <script src="/static/js/export-manager.js"></script>
</body>
</html>