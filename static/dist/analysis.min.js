window.TechnicalChartsManager=class{constructor(){this.charts={},this.colors={primary:"rgb(102, 126, 234)",secondary:"rgb(118, 75, 162)",success:"rgb(72, 187, 120)",danger:"rgb(245, 101, 101)",warning:"rgb(237, 137, 54)",info:"rgb(66, 153, 225)",grid:"rgba(255, 255, 255, 0.05)",text:"rgba(255, 255, 255, 0.7)"}}createPriceChartWithBollinger(e,t){const i=document.getElementById(e);if(!i)return console.error(`Canvas ${e} not found`),null;this.charts[e]&&this.charts[e].destroy();const{dates:a,prices:s,bollinger:n}=t,r=[{label:"Price",data:s,borderColor:this.colors.primary,backgroundColor:"rgba(102, 126, 234, 0.1)",borderWidth:2,fill:!0,tension:.4,pointRadius:0,pointHoverRadius:5,order:1}];return n&&r.push({label:"Upper Band",data:n.upper,borderColor:"rgba(237, 137, 54, 0.5)",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0,order:2},{label:"Middle Band (SMA 20)",data:n.middle,borderColor:"rgba(255, 255, 255, 0.3)",borderWidth:1,borderDash:[2,2],fill:!1,pointRadius:0,order:2},{label:"Lower Band",data:n.lower,borderColor:"rgba(72, 187, 120, 0.5)",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0,order:2}),this.charts[e]=new Chart(i,{type:"line",data:{labels:a,datasets:r},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:"Price with Bollinger Bands",color:this.colors.text,font:{size:16,weight:"bold"}},legend:{display:!0,position:"top",labels:{color:this.colors.text,usePointStyle:!0,padding:15}},tooltip:{backgroundColor:"rgba(17, 25, 40, 0.95)",titleColor:"#fff",bodyColor:"#fff",borderColor:this.colors.primary,borderWidth:1,padding:12,displayColors:!0,callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),t+="$"+e.parsed.y.toFixed(2),t}}}},scales:{x:{grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,maxTicksLimit:10}},y:{position:"right",grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,callback:function(e){return"$"+e.toFixed(2)}}}}}}),this.charts[e]}createMACDChart(e,t){const i=document.getElementById(e);if(!i)return console.error(`Canvas ${e} not found`),null;this.charts[e]&&this.charts[e].destroy();const{dates:a,macd:s,signal:n,histogram:r}=t,o=r.map(e=>e>=0?"rgba(72, 187, 120, 0.5)":"rgba(245, 101, 101, 0.5)");return this.charts[e]=new Chart(i,{type:"bar",data:{labels:a,datasets:[{type:"line",label:"MACD",data:s,borderColor:this.colors.primary,backgroundColor:"transparent",borderWidth:2,pointRadius:0,pointHoverRadius:5,tension:.4,order:1},{type:"line",label:"Signal",data:n,borderColor:this.colors.warning,backgroundColor:"transparent",borderWidth:2,borderDash:[5,5],pointRadius:0,pointHoverRadius:5,tension:.4,order:1},{type:"bar",label:"Histogram",data:r,backgroundColor:o,borderWidth:0,order:2}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:"MACD (Moving Average Convergence Divergence)",color:this.colors.text,font:{size:16,weight:"bold"}},legend:{display:!0,position:"top",labels:{color:this.colors.text,usePointStyle:!0,padding:15}},tooltip:{backgroundColor:"rgba(17, 25, 40, 0.95)",titleColor:"#fff",bodyColor:"#fff",borderColor:this.colors.primary,borderWidth:1,padding:12,callbacks:{label:function(e){let t=e.dataset.label||"";return t&&(t+=": "),t+=e.parsed.y.toFixed(4),t}}}},scales:{x:{grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,maxTicksLimit:10}},y:{position:"right",grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)",drawBorder:!0},ticks:{color:this.colors.text}}}}}),this.charts[e]}createRSIChart(e,t){const i=document.getElementById(e);if(!i)return console.error(`Canvas ${e} not found`),null;this.charts[e]&&this.charts[e].destroy();const{dates:a,rsi:s}=t,n=new Array(a.length).fill(70),r=new Array(a.length).fill(30),o=new Array(a.length).fill(50);return this.charts[e]=new Chart(i,{type:"line",data:{labels:a,datasets:[{label:"RSI",data:s,borderColor:this.colors.primary,backgroundColor:"rgba(102, 126, 234, 0.1)",borderWidth:2,fill:!0,tension:.4,pointRadius:0,pointHoverRadius:5,order:1},{label:"Overbought (70)",data:n,borderColor:"rgba(245, 101, 101, 0.5)",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0,order:2},{label:"Oversold (30)",data:r,borderColor:"rgba(72, 187, 120, 0.5)",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0,order:2},{label:"Middle (50)",data:o,borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1,borderDash:[2,2],fill:!1,pointRadius:0,order:3}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:"RSI (Relative Strength Index)",color:this.colors.text,font:{size:16,weight:"bold"}},legend:{display:!0,position:"top",labels:{color:this.colors.text,usePointStyle:!0,padding:15}},tooltip:{backgroundColor:"rgba(17, 25, 40, 0.95)",titleColor:"#fff",bodyColor:"#fff",borderColor:this.colors.primary,borderWidth:1,padding:12,callbacks:{label:function(e){if("RSI"===e.dataset.label){const t=e.parsed.y;let i="";return t>70?i=" (Overbought)":t<30&&(i=" (Oversold)"),`RSI: ${t.toFixed(2)}${i}`}return""}}},annotation:{annotations:{overboughtZone:{type:"box",yMin:70,yMax:100,backgroundColor:"rgba(245, 101, 101, 0.1)",borderWidth:0},oversoldZone:{type:"box",yMin:0,yMax:30,backgroundColor:"rgba(72, 187, 120, 0.1)",borderWidth:0}}}},scales:{x:{grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,maxTicksLimit:10}},y:{position:"right",min:0,max:100,grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,stepSize:10}}}}}),this.charts[e]}createVolumeChartWithMA(e,t){const i=document.getElementById(e);if(!i)return console.error(`Canvas ${e} not found`),null;this.charts[e]&&this.charts[e].destroy();const{dates:a,volumes:s,volumeMA:n}=t,r=[{type:"bar",label:"Volume",data:s,backgroundColor:t.priceChanges?t.priceChanges.map(e=>e>=0?"rgba(72, 187, 120, 0.6)":"rgba(245, 101, 101, 0.6)"):new Array(s.length).fill("rgba(102, 126, 234, 0.6)"),borderWidth:0,order:2}];return n&&r.push({type:"line",label:"Volume MA (20)",data:n,borderColor:this.colors.warning,backgroundColor:"transparent",borderWidth:2,pointRadius:0,pointHoverRadius:5,tension:.4,order:1}),this.charts[e]=new Chart(i,{type:"bar",data:{labels:a,datasets:r},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{title:{display:!0,text:"Trading Volume",color:this.colors.text,font:{size:16,weight:"bold"}},legend:{display:!0,position:"top",labels:{color:this.colors.text,usePointStyle:!0,padding:15}},tooltip:{backgroundColor:"rgba(17, 25, 40, 0.95)",titleColor:"#fff",bodyColor:"#fff",borderColor:this.colors.primary,borderWidth:1,padding:12,callbacks:{label:function(e){let t=e.dataset.label||"";t&&(t+=": ");const i=e.parsed.y;return t+=i>=1e6?(i/1e6).toFixed(2)+"M":i>=1e3?(i/1e3).toFixed(2)+"K":i.toLocaleString(),t}}}},scales:{x:{grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,maxTicksLimit:10}},y:{position:"right",beginAtZero:!0,grid:{color:this.colors.grid,borderColor:"rgba(255, 255, 255, 0.1)"},ticks:{color:this.colors.text,maxTicksLimit:5,callback:function(e){return e>=1e6?(e/1e6).toFixed(1)+"M":e>=1e3?(e/1e3).toFixed(0)+"K":e}}}}}}),this.charts[e]}createTechnicalDashboard(e,t){console.log("[TechnicalCharts] Creating dashboard for",t.ticker);const i=document.getElementById(e);i?(i.innerHTML='\n            <div class="technical-charts-grid">\n                <div class="chart-card">\n                    <canvas id="priceWithBollinger"></canvas>\n                </div>\n                <div class="chart-card">\n                    <canvas id="macdChart"></canvas>\n                </div>\n                <div class="chart-card">\n                    <canvas id="rsiChart"></canvas>\n                </div>\n                <div class="chart-card">\n                    <canvas id="volumeChart"></canvas>\n                </div>\n            </div>\n        ',setTimeout(()=>{this.createPriceChartWithBollinger("priceWithBollinger",{dates:t.dates,prices:t.prices,bollinger:t.bollinger}),this.createMACDChart("macdChart",{dates:t.dates,macd:t.macd.macd,signal:t.macd.signal,histogram:t.macd.histogram}),this.createRSIChart("rsiChart",{dates:t.dates,rsi:t.rsi}),this.createVolumeChartWithMA("volumeChart",{dates:t.dates,volumes:t.volumes,volumeMA:t.volumeMA,priceChanges:t.priceChanges}),console.log("[TechnicalCharts] Dashboard created successfully")},100)):console.error(`Container ${e} not found`)}destroyChart(e){this.charts[e]&&(this.charts[e].destroy(),delete this.charts[e])}destroyAll(){Object.keys(this.charts).forEach(e=>{this.destroyChart(e)})}},(()=>{class AdvancedChart{constructor(e,t={}){this.canvasId=e,this.canvas=document.getElementById(e),this.canvas?(this.options={height:t.height||400,showVolume:!1!==t.showVolume,showGrid:!1!==t.showGrid,candlestick:!1!==t.candlestick,...t},this.chart=null,this.data=null,this.indicators={sma20:!1,sma50:!1,sma200:!1,ema12:!1,ema26:!1,bb:!1,rsi:!1,macd:!1},this.trendlines=[],this.drawingMode=!1,this.currentTrendline=null,this.init()):console.error(`Canvas ${e} not found`)}init(){this.canvas.style.height=`${this.options.height}px`,this.canvas.addEventListener("mousedown",e=>this.onMouseDown(e)),this.canvas.addEventListener("mousemove",e=>this.onMouseMove(e)),this.canvas.addEventListener("mouseup",e=>this.onMouseUp(e))}async loadData(e,t="6mo"){try{const i=await fetch(`/api/stock/${e}/history?period=${t}`),a=await i.json();if(!a.data||0===a.data.length)throw new Error("No data available");this.data=a.data,this.ticker=e,this.period=t,this.render()}catch(e){console.error("Error loading chart data:",e),this.showError("Failed to load chart data")}}render(){if(!this.data||0===this.data.length)return;this.chart&&this.chart.destroy();const e=this.canvas.getContext("2d"),t=this.data.map(e=>e.date),i=[];if(this.options.candlestick&&this.data[0].high){const e=this.data.map(e=>({x:e.date,o:e.open,h:e.high,l:e.low,c:e.close}));i.push({label:this.ticker,data:e,type:"candlestick",color:{up:"rgba(72, 187, 120, 1)",down:"rgba(245, 101, 101, 1)",unchanged:"rgba(128, 128, 128, 1)"}})}else{const e=this.data.map(e=>e.close);i.push({label:this.ticker,data:e,borderColor:"rgb(102, 126, 234)",backgroundColor:"rgba(102, 126, 234, 0.1)",borderWidth:2,fill:!0,tension:.1,pointRadius:0,pointHoverRadius:4})}this.addIndicatorDatasets(i,t),this.chart=new Chart(e,{type:this.options.candlestick?"candlestick":"line",data:{labels:t,datasets:i},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top",labels:{color:"rgba(255, 255, 255, 0.8)",font:{size:11},usePointStyle:!0,filter:e=>e.text===this.ticker||this.indicators[e.text.toLowerCase().replace(/\s/g,"")]}},tooltip:{backgroundColor:"rgba(26, 32, 44, 0.95)",titleColor:"rgba(255, 255, 255, 0.9)",bodyColor:"rgba(255, 255, 255, 0.8)",borderColor:"rgba(102, 126, 234, 0.5)",borderWidth:1,padding:12,displayColors:!0,callbacks:{label:e=>`${e.dataset.label||""}: $${e.parsed.y.toFixed(2)}`}},crosshair:{line:{color:"rgba(255, 255, 255, 0.3)",width:1},sync:{enabled:!1}}},scales:{x:{display:!0,grid:{display:this.options.showGrid,color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.6)",maxTicksLimit:10}},y:{display:!0,position:"right",grid:{display:this.options.showGrid,color:"rgba(255, 255, 255, 0.05)"},ticks:{color:"rgba(255, 255, 255, 0.6)",callback:e=>"$"+e.toFixed(2)}}},animation:{duration:500}}}),this.drawTrendlines()}addIndicatorDatasets(e,t){const i=this.data.map(e=>e.close);if(this.indicators.sma20){const t=this.calculateSMA(i,20);e.push({label:"SMA 20",data:t,borderColor:"rgba(255, 193, 7, 0.8)",borderWidth:1.5,fill:!1,tension:0,pointRadius:0})}if(this.indicators.sma50){const t=this.calculateSMA(i,50);e.push({label:"SMA 50",data:t,borderColor:"rgba(72, 187, 120, 0.8)",borderWidth:1.5,fill:!1,tension:0,pointRadius:0})}if(this.indicators.sma200){const t=this.calculateSMA(i,200);e.push({label:"SMA 200",data:t,borderColor:"rgba(245, 101, 101, 0.8)",borderWidth:2,fill:!1,tension:0,pointRadius:0})}if(this.indicators.ema12){const t=this.calculateEMA(i,12);e.push({label:"EMA 12",data:t,borderColor:"rgba(156, 39, 176, 0.8)",borderWidth:1.5,fill:!1,tension:0,pointRadius:0})}if(this.indicators.ema26){const t=this.calculateEMA(i,26);e.push({label:"EMA 26",data:t,borderColor:"rgba(33, 150, 243, 0.8)",borderWidth:1.5,fill:!1,tension:0,pointRadius:0})}if(this.indicators.bb){const t=this.calculateBollingerBands(i,20,2);e.push({label:"BB Upper",data:t.upper,borderColor:"rgba(255, 152, 0, 0.5)",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0}),e.push({label:"BB Lower",data:t.lower,borderColor:"rgba(255, 152, 0, 0.5)",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0})}}toggleIndicator(e){return!!this.indicators.hasOwnProperty(e)&&(this.indicators[e]=!this.indicators[e],this.render(),this.indicators[e])}enableDrawing(){this.drawingMode=!0,this.canvas.style.cursor="crosshair"}disableDrawing(){this.drawingMode=!1,this.canvas.style.cursor="default",this.currentTrendline=null}onMouseDown(e){if(!this.drawingMode||!this.chart)return;const t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top,s=this.chart.scales.x.getValueForPixel(i),n=this.chart.scales.y.getValueForPixel(a);this.currentTrendline={startX:s,startY:n,endX:s,endY:n,color:"rgba(255, 193, 7, 0.8)",width:2}}onMouseMove(e){if(!this.drawingMode||!this.currentTrendline||!this.chart)return;const t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top,s=this.chart.scales.x.getValueForPixel(i),n=this.chart.scales.y.getValueForPixel(a);this.currentTrendline.endX=s,this.currentTrendline.endY=n,this.drawTrendlines()}onMouseUp(e){this.drawingMode&&this.currentTrendline&&(this.trendlines.push({...this.currentTrendline}),this.currentTrendline=null,this.disableDrawing(),this.render())}drawTrendlines(){if(!this.chart)return;const e=this.chart.ctx;this.chart.chartArea,this.trendlines.forEach(t=>{this.drawLine(e,t)}),this.currentTrendline&&this.drawLine(e,this.currentTrendline)}drawLine(e,t){if(!this.chart)return;const i=this.chart.scales.x,a=this.chart.scales.y,s=i.getPixelForValue(t.startX),n=a.getPixelForValue(t.startY),r=i.getPixelForValue(t.endX),o=a.getPixelForValue(t.endY);e.save(),e.beginPath(),e.moveTo(s,n),e.lineTo(r,o),e.strokeStyle=t.color,e.lineWidth=t.width,e.stroke(),e.restore()}clearTrendlines(){this.trendlines=[],this.render()}calculateSMA(e,t){const i=[];for(let a=0;a<e.length;a++)if(a<t-1)i.push(null);else{const s=e.slice(a-t+1,a+1).reduce((e,t)=>e+t,0);i.push(s/t)}return i}calculateEMA(e,t){const i=2/(t+1),a=[];let s=e[0];a.push(s);for(let t=1;t<e.length;t++)s=e[t]*i+s*(1-i),a.push(s);return a}calculateBollingerBands(e,t,i){const a=this.calculateSMA(e,t),s=[],n=[];for(let r=0;r<e.length;r++)if(r<t-1)s.push(null),n.push(null);else{const o=e.slice(r-t+1,r+1),l=a[r],c=o.reduce((e,t)=>e+Math.pow(t-l,2),0)/t,d=Math.sqrt(c);s.push(l+d*i),n.push(l-d*i)}return{upper:s,middle:a,lower:n}}showError(e){this.canvas.parentElement.innerHTML=`\n            <div style="display: flex; align-items: center; justify-content: center; height: ${this.options.height}px; color: rgba(255, 255, 255, 0.6);">\n                <div style="text-align: center;">\n                    <div style="font-size: 48px; margin-bottom: 10px;">⚠️</div>\n                    <div>${e}</div>\n                </div>\n            </div>\n        `}destroy(){this.chart&&(this.chart.destroy(),this.chart=null)}}"undefined"!=typeof window&&(window.AdvancedChart=AdvancedChart)})(),window.AIAnalysisVisualizer=class{constructor(){this.radarChart=null,this.riskChart=null,this.technicalChart=null,this.currentTicker=null,this.priceData=null,this.showSMA50=!1,this.showSMA200=!1,this.showBB=!1}async renderAnalysis(e,t=null){const i=document.getElementById("ai-tab");i.innerHTML='<div class="loading-spinner">KI-Analyse wird durchgeführt...</div>',this.currentTicker=e;try{const a=await fetch(`/api/stock/${e}/analyze-with-ai`);if(!a.ok)throw new Error("AI analysis failed");const s=await a.json();t&&(s.current_price=t),i.innerHTML=this.generateAnalysisHTML(s),setTimeout(()=>{this.initializeCharts(s),this.loadTechnicalChart(e)},100)}catch(e){console.error("AI Analysis Error:",e),i.innerHTML=this.generateErrorHTML()}}generateAnalysisHTML(e){const t=this.extractRecommendation(e),i=e.confidence_score||0,a=this.extractPriceTarget(e);return`\n            <div class="ai-analysis-container">\n                \x3c!-- Executive Summary --\x3e\n                <div class="ai-summary-card">\n                    <div class="ai-summary-header">\n                        <h3>📊 Due Diligence Zusammenfassung</h3>\n                        <div class="ai-provider-badge">\n                            <span class="provider-icon">✨</span>\n                            <span>${"google"===e.provider?"Google Gemini 2.5 Pro":"OpenAI GPT-4"}</span>\n                        </div>\n                    </div>\n\n                    <div class="ai-recommendation-box ${t.type}">\n                        <div class="rec-icon">${t.icon}</div>\n                        <div class="rec-content">\n                            <div class="rec-label">Empfehlung</div>\n                            <div class="rec-value">${t.text}</div>\n                        </div>\n                        ${a.value?`\n                        <div class="price-target-meter">\n                            <div class="pt-label">12-Monats Kursziel</div>\n                            <div class="pt-value">$${a.value}</div>\n                            <div class="pt-upside ${a.upside>=0?"positive":"negative"}">\n                                ${a.upside>=0?"+":""}${a.upside}% Potenzial\n                            </div>\n                        </div>\n                        `:""}\n                        <div class="confidence-meter">\n                            <div class="confidence-label">Konfidenz</div>\n                            <div class="confidence-value">${i.toFixed(0)}%</div>\n                            <div class="confidence-bar">\n                                <div class="confidence-fill" style="width: ${i}%"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Score Dashboard --\x3e\n                <div class="ai-scores-grid">\n                    ${this.generateScoreCards(e)}\n                </div>\n\n                \x3c!-- Technical Price Chart with Indicators --\x3e\n                <div class="ai-card full-width-card">\n                    <div class="chart-header">\n                        <h4>📊 Technischer Preis-Chart mit Indikatoren</h4>\n                        <div class="chart-controls-inline">\n                            <label class="indicator-toggle">\n                                <input type="checkbox" id="aiChartSMA50" onchange="window.aiVisualizer.toggleChartIndicator('sma50', this.checked)">\n                                <span>SMA 50</span>\n                            </label>\n                            <label class="indicator-toggle">\n                                <input type="checkbox" id="aiChartSMA200" onchange="window.aiVisualizer.toggleChartIndicator('sma200', this.checked)">\n                                <span>SMA 200</span>\n                            </label>\n                            <label class="indicator-toggle">\n                                <input type="checkbox" id="aiChartBB" onchange="window.aiVisualizer.toggleChartIndicator('bb', this.checked)">\n                                <span>Bollinger Bands</span>\n                            </label>\n                        </div>\n                    </div>\n                    <div class="technical-chart-container">\n                        <canvas id="aiTechnicalChart"></canvas>\n                    </div>\n                </div>\n\n                \x3c!-- Visual Analysis Section --\x3e\n                <div class="ai-visual-section">\n                    <div class="ai-card">\n                        <h4>📈 Fundamentale Stärken</h4>\n                        <canvas id="fundamentalRadarChart"></canvas>\n                    </div>\n\n                    <div class="ai-card">\n                        <h4>⚖️ Risiko vs. Chancen</h4>\n                        <canvas id="riskOpportunityChart"></canvas>\n                    </div>\n                </div>\n\n                \x3c!-- Short Squeeze Indicator --\x3e\n                ${this.generateShortSqueezeIndicator(e)}\n\n                \x3c!-- Squeeze Price Scenarios --\x3e\n                ${this.generateSqueezeScenariosCard(e)}\n\n                \x3c!-- Technical Indicators Summary --\x3e\n                <div class="ai-card">\n                    <h4>📉 Technische Indikatoren</h4>\n                    ${this.generateTechnicalSummary(e)}\n                </div>\n\n                \x3c!-- Risks & Opportunities --\x3e\n                <div class="ai-insights-grid">\n                    <div class="ai-card insights-card risks">\n                        <h4>⚠️ Hauptrisiken</h4>\n                        ${this.generateInsightsList(e.ai_analysis?.risks,"risk")}\n                    </div>\n\n                    <div class="ai-card insights-card opportunities">\n                        <h4>🎯 Chancen</h4>\n                        ${this.generateInsightsList(e.ai_analysis?.opportunities,"opportunity")}\n                    </div>\n                </div>\n\n                \x3c!-- Detailed Analysis (Collapsible) --\x3e\n                <div class="ai-card">\n                    <div class="expandable-section">\n                        <button class="expand-btn" onclick="this.parentElement.classList.toggle('expanded')">\n                            <span>📋 Detaillierte Analyse anzeigen</span>\n                            <span class="expand-icon">▼</span>\n                        </button>\n                        <div class="expanded-content">\n                            <div class="detailed-section">\n                                <h5>Technische Analyse</h5>\n                                <div class="analysis-text">${this.formatAnalysisText(e.ai_analysis?.technical_analysis)}</div>\n                            </div>\n                            <div class="detailed-section">\n                                <h5>Fundamentalanalyse</h5>\n                                <div class="analysis-text">${this.formatAnalysisText(e.ai_analysis?.fundamental_analysis)}</div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                \x3c!-- Timestamp --\x3e\n                <div class="ai-timestamp">\n                    Analyse erstellt: ${new Date(e.timestamp).toLocaleString("de-DE")}\n                </div>\n            </div>\n        `}extractRecommendation(e){const t=`${e.raw_analysis?.toLowerCase()||""} ${e.ai_analysis?.recommendation?.toLowerCase()||""} ${e.ai_analysis?.summary?.toLowerCase()||""}`;return t.includes("buy")||t.includes("kaufen")?{type:"buy",text:"KAUFEN",icon:"📈"}:t.includes("sell")||t.includes("verkaufen")?{type:"sell",text:"VERKAUFEN",icon:"📉"}:{type:"hold",text:"HALTEN",icon:"⏸️"}}extractPriceTarget(e){console.log("[AI] Extracting price target from data");const t=e.raw_analysis||"",i=e.ai_analysis?.price_target||"",a=`${t} ${i} ${e.ai_analysis?.recommendation||""}`;console.log("[AI] Searching in text length:",a.length);const s=[/(?:target|kursziel).*?\$(\d+(?:\.\d{1,2})?)/i,/price\s+target.*?\$(\d+(?:\.\d{1,2})?)/i,/fair\s+value.*?\$(\d+(?:\.\d{1,2})?)/i,/target\s+price\s+of\s+(\d+(?:\.\d{1,2})?)/i,/kursziel.*?(\d+(?:\.\d{1,2})?)/i,/\$(\d+(?:\.\d{1,2})?)\s+target/i];let n=null;for(const e of s){const t=a.match(e);if(t){n=parseFloat(t[1]),console.log("[AI] Price target found with pattern:",e,"→",n);break}}if(!n&&i){const e=/\$(\d+(?:\.\d{1,2})?)/g,t=[...i.matchAll(e)];if(t.length>0)for(const e of t){const t=parseFloat(e[1]);if(t>=1&&t<=1e4){n=t,console.log("[AI] Price target found in section:",n);break}}}let r=0;n&&e.current_price&&(r=((n-e.current_price)/e.current_price*100).toFixed(1),console.log("[AI] Calculated upside:",r,"% (current:",e.current_price,", target:",n,")"));const o={value:n?n.toFixed(2):null,upside:parseFloat(r)};return console.log("[AI] Price target result:",o),o}generateScoreCards(e){return[{label:"Technisch",value:this.extractTechnicalScore(e),icon:"📊",color:"#3b82f6"},{label:"Fundamental",value:this.extractFundamentalScore(e),icon:"💼",color:"#8b5cf6"},{label:"Wert",value:this.extractValueScore(e),icon:"💰",color:"#10b981"},{label:"Momentum",value:this.extractMomentumScore(e),icon:"🚀",color:"#f59e0b"}].map(e=>`\n            <div class="score-card" style="--card-color: ${e.color}">\n                <div class="score-icon">${e.icon}</div>\n                <div class="score-content">\n                    <div class="score-label">${e.label}</div>\n                    <div class="score-value">${e.value}/100</div>\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${e.value}%; background: ${e.color}"></div>\n                    </div>\n                </div>\n            </div>\n        `).join("")}generateShortSqueezeIndicator(e){const t=e.ai_analysis?.short_squeeze||"",i=this.extractSqueezeScore(t);if(!t||null===i)return"";const a=this.getFlameLevel(i),s=this.generateSqueezeExplanation(i,t);return`\n            <div class="short-squeeze-card">\n                <div class="squeeze-header">\n                    <h4>🔥 Short Squeeze Potenzial</h4>\n                    <div class="squeeze-score-badge ${a.class}">\n                        ${i}/100\n                    </div>\n                </div>\n\n                <div class="squeeze-visual">\n                    <div class="flame-container ${a.class}">\n                        ${this.generateFlames(i)}\n                        <div class="squeeze-label">${a.label}</div>\n                    </div>\n                </div>\n\n                \x3c!-- Probability Explanation --\x3e\n                <div class="squeeze-explanation">\n                    <div class="explanation-header">\n                        <span class="explanation-icon">💡</span>\n                        <strong>Wahrscheinlichkeit & Einschätzung:</strong>\n                    </div>\n                    <div class="explanation-text">\n                        ${s}\n                    </div>\n                </div>\n\n                <div class="squeeze-analysis">\n                    <div class="squeeze-factors">\n                        <h5>📊 Due Diligence Faktoren:</h5>\n                        ${this.extractSqueezeFactors(t)}\n                    </div>\n                    <div class="squeeze-details">\n                        <button class="details-btn" onclick="this.parentElement.parentElement.classList.toggle('expanded')">\n                            <span>Vollständige Analyse anzeigen</span>\n                            <span class="expand-icon">▼</span>\n                        </button>\n                        <div class="squeeze-full-text">\n                            ${this.formatAnalysisText(t)}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}extractSqueezeScore(e){if(!e)return null;const t=[/(\d+)\/100/,/score.*?(\d+)/i,/risk.*?(\d+)/i,/potential.*?(\d+)/i,/rating.*?(\d+)/i];for(const i of t){const t=e.match(i);if(t){const e=parseInt(t[1]);if(e>=0&&e<=100)return e}}return null}getFlameLevel(e){return e>=80?{class:"extreme",label:"EXTREM HOCH",color:"#dc2626"}:e>=60?{class:"high",label:"HOCH",color:"#f59e0b"}:e>=40?{class:"moderate",label:"MODERAT",color:"#eab308"}:e>=20?{class:"low",label:"NIEDRIG",color:"#3b82f6"}:{class:"minimal",label:"MINIMAL",color:"#6b7280"}}generateFlames(e){const t=Math.ceil(e/20);let i="";for(let e=0;e<5;e++)i+=e<t?`<span class="flame active" style="animation-delay: ${.1*e}s;">🔥</span>`:'<span class="flame inactive">🔥</span>';return`<div class="flames">${i}</div>`}generateSqueezeExplanation(e,t){let i="",a="";e>=80?(i="🔴 <strong>EXTREM WAHRSCHEINLICH</strong>",a="Alle Indikatoren deuten auf ein sehr hohes Short Squeeze Potenzial hin. Die Kombination aus hohem Short Interest, begrenztem Float und starkem Kaufdruck schafft optimale Bedingungen."):e>=60?(i="🟠 <strong>WAHRSCHEINLICH</strong>",a="Die meisten Faktoren unterstützen ein Short Squeeze Szenario. Short Interest und Float-Situation sind günstig, jedoch sollten Katalysatoren und Volumen beobachtet werden."):e>=40?(i="🟡 <strong>MÖGLICH</strong>",a="Ein Short Squeeze ist möglich, aber nicht garantiert. Einige Faktoren sind positiv, andere neutral. Es bedarf zusätzlicher Katalysatoren oder erhöhtem Kaufdruck."):e>=20?(i="🔵 <strong>UNWAHRSCHEINLICH</strong>",a="Die Bedingungen für einen Short Squeeze sind aktuell nicht optimal. Short Interest oder Float-Verfügbarkeit sind nicht ausreichend, oder es fehlt an Momentum."):(i="⚪ <strong>SEHR UNWAHRSCHEINLICH</strong>",a="Ein Short Squeeze ist unter den aktuellen Bedingungen sehr unwahrscheinlich. Die fundamentalen Voraussetzungen (Short Interest, Float, Volumen) sind nicht gegeben.");let s="";if(t.toLowerCase().includes("warum")||t.toLowerCase().includes("because")||t.toLowerCase().includes("da ")){const e=t.match(/(?:warum|because|da\s+)(.*?)(?:\.|$)/i);e&&e[1]&&(s=`<br><br><em>Spezifische Gründe:</em> ${e[1].trim()}`)}return`\n            <div class="probability-statement">${i}</div>\n            <div class="reasoning-text">${a}${s}</div>\n        `}extractSqueezeFactors(e){console.log("[AI] Extracting squeeze factors from text length:",e?.length);const t=[];if(e.toLowerCase().includes("float")||e.toLowerCase().includes("freefloat")){const i=e.match(/(?:free\s*)?float.*?(\d+(?:\.\d+)?)\s*(?:%|prozent|percent|million|m\b)/i);if(i){const e=i[1],a=/(%|prozent|percent)/.test(i[0]),s=/(million|m\b)/i.test(i[0]);t.push({icon:"🏦",label:"Freefloat",value:a?`${e}%`:s?`${e}M Aktien`:e,status:a&&parseFloat(e)<50?"high":"normal",description:"Verfügbare handelbare Aktien"})}else e.toLowerCase().includes("float")&&t.push({icon:"🏦",label:"Freefloat",value:"Begrenzt",status:"high",description:"Niedriger Float erhöht Squeeze-Potenzial"})}if(e.toLowerCase().includes("short interest")||e.toLowerCase().includes("short %")||e.toLowerCase().includes("shortquote")){const i=e.match(/short\s+(?:interest|quote|%).*?(\d+(?:\.\d+)?)\s*%/i);if(i){const e=parseFloat(i[1]);t.push({icon:"📊",label:"Short Interest",value:`${e}%`,status:e>20?"high":e>10?"moderate":"normal",description:e>30?"Extrem hoch!":e>20?"Sehr hoch":e>10?"Erhöht":"Normal"})}else if(e.toLowerCase().includes("short")){const i=e.match(/short.*?(\d+(?:\.\d+)?)\s*(?:%|prozent)/i);i?t.push({icon:"📊",label:"Short Interest",value:`${i[1]}%`,status:parseFloat(i[1])>20?"high":"normal",description:"Anteil leerverkaufter Aktien"}):t.push({icon:"📊",label:"Short Interest",value:"Erhöht",status:"high",description:"Signifikantes Short Interest vorhanden"})}}if(e.toLowerCase().includes("days to cover")||e.toLowerCase().includes("tage bis")){const i=e.match(/days\s+to\s+cover.*?(\d+(?:\.\d+)?)/i);if(i){const e=parseFloat(i[1]);t.push({icon:"📅",label:"Days to Cover",value:`${e} Tage`,status:e>5?"high":e>3?"moderate":"normal",description:e>5?"Hoher Deckungsbedarf!":"Zeit zum Schließen von Shorts"})}}if(e.toLowerCase().includes("ftd")||e.toLowerCase().includes("failure to deliver")||e.toLowerCase().includes("lieferausfall")){const i=e.match(/ftd.*?(\d+(?:,\d+)?)\s*(?:shares|aktien|million|m\b)/i);i?t.push({icon:"⚠️",label:"FTDs",value:i[1].replace(",",".")+(i[0].toLowerCase().includes("million")?"M":""),status:"high",description:"Nicht gelieferte Aktien - Squeeze-Katalysator!"}):e.toLowerCase().includes("ftd")&&t.push({icon:"⚠️",label:"FTDs",value:"Erhöht",status:"high",description:"Lieferausfälle detektiert"})}if(e.toLowerCase().includes("volume")||e.toLowerCase().includes("spike")||e.toLowerCase().includes("handelsvolumen")){const i=e.match(/volume.*?(\d+(?:\.\d+)?)\s*(?:million|m\b|prozent|%)/i);i?t.push({icon:"📈",label:"Handelsvolumen",value:i[0].includes("%")?`+${i[1]}%`:`${i[1]}M`,status:"high",description:"Erhöhte Handelsaktivität"}):t.push({icon:"📈",label:"Volumen Aktivität",value:e.toLowerCase().includes("high")||e.toLowerCase().includes("spike")||e.toLowerCase().includes("erhöht")?"Erhöht":"Normal",status:e.toLowerCase().includes("high")||e.toLowerCase().includes("spike")?"high":"normal",description:"Handelsaktivität"})}if((e.toLowerCase().includes("sentiment")||e.toLowerCase().includes("retail")||e.toLowerCase().includes("social media")||e.toLowerCase().includes("reddit"))&&t.push({icon:"💬",label:"Retail Sentiment",value:e.toLowerCase().includes("strong")||e.toLowerCase().includes("bullish")||e.toLowerCase().includes("stark")?"Stark Bullish":"Moderat",status:e.toLowerCase().includes("strong")||e.toLowerCase().includes("bullish")?"high":"normal",description:"Kleinanleger-Stimmung"}),e.toLowerCase().includes("option")||e.toLowerCase().includes("call")||e.toLowerCase().includes("put")){const i=e.match(/(?:call|put).*?ratio.*?(\d+(?:\.\d+)?)/i);i?t.push({icon:"📑",label:"Options Aktivität",value:`Ratio: ${i[1]}`,status:"high",description:"Optionshandel-Aktivität"}):t.push({icon:"📑",label:"Options Aktivität",value:e.toLowerCase().includes("unusual")||e.toLowerCase().includes("erhöht")?"Ungewöhnlich Hoch":"Erhöht",status:"high",description:"Gamma Squeeze möglich"})}return(e.toLowerCase().includes("catalyst")||e.toLowerCase().includes("katalysator")||e.toLowerCase().includes("announcement"))&&t.push({icon:"🎯",label:"Katalysatoren",value:"Vorhanden",status:"high",description:"News/Events als Auslöser"}),console.log("[AI] Extracted",t.length,"squeeze factors"),0===t.length?'\n                <div class="due-diligence-summary">\n                    <p class="no-factors-msg">\n                        📋 <strong>Hinweis:</strong> Keine spezifischen Squeeze-Faktoren in der Analyse gefunden. \n                        Lesen Sie die vollständige Analyse unten für Details.\n                    </p>\n                </div>\n            ':`\n            <div class="squeeze-factors-grid">\n                ${t.map(e=>`\n                    <div class="squeeze-factor ${e.status}">\n                        <div class="factor-header">\n                            <span class="factor-icon">${e.icon}</span>\n                            <div class="factor-label">${e.label}</div>\n                        </div>\n                        <div class="factor-value">${e.value}</div>\n                        <div class="factor-description">${e.description}</div>\n                    </div>\n                `).join("")}\n            </div>\n            <div class="dd-disclaimer">\n                <small>⚠️ Dies ist keine Anlageberatung. Short Squeezes sind hochriskant und unvorhersehbar. Eigene Due Diligence erforderlich.</small>\n            </div>\n        `}generateTechnicalSummary(e){const t=e.ai_analysis?.technical_analysis||"",i=t.match(/RSI.*?(\d+\.?\d*)/i),a=t.match(/MACD.*?(\d+\.?\d*)/i),s=t.match(/[Vv]olatility.*?(\d+\.?\d*)/i),n=i?parseFloat(i[1]):null,r=a?parseFloat(a[1]):null,o=s?parseFloat(s[1]):null;return`\n            <div class="technical-indicators-grid">\n                ${n?`\n                <div class="indicator-card">\n                    <div class="indicator-label">RSI</div>\n                    <div class="indicator-value ${n>70?"overbought":n<30?"oversold":""}">${n.toFixed(1)}</div>\n                    <div class="indicator-status">${n>70?"Überkauft":n<30?"Überverkauft":"Neutral"}</div>\n                </div>\n                `:""}\n\n                ${r?`\n                <div class="indicator-card">\n                    <div class="indicator-label">MACD</div>\n                    <div class="indicator-value ${r>0?"positive":"negative"}">${r.toFixed(2)}</div>\n                    <div class="indicator-status">${r>0?"Bullisch":"Bärisch"}</div>\n                </div>\n                `:""}\n\n                ${o?`\n                <div class="indicator-card">\n                    <div class="indicator-label">Volatilität</div>\n                    <div class="indicator-value">${(100*o).toFixed(1)}%</div>\n                    <div class="indicator-status">${o>.5?"Hoch":"Normal"}</div>\n                </div>\n                `:""}\n            </div>\n        `}generateInsightsList(e,t){if(!e||0===e.trim().length)return`<p class="no-data">Keine ${"risk"===t?"Risiken":"Chancen"} identifiziert</p>`;console.log(`[AI] Generating ${t} list from text length:`,e.length);let i=e.split(/\d+\.\s+|\*\s+|\-\s+/).filter(e=>e.trim().length>10);return 0===i.length&&(i=e.split(/\n/).filter(e=>e.trim().length>10)),0===i.length&&(i=e.split(/\.\s+/).filter(e=>e.trim().length>20)),console.log(`[AI] Found ${i.length} ${t} items`),0===i.length?`\n                <div class="insight-item">\n                    <span class="insight-bullet">${"risk"===t?"⚠️":"✅"}</span>\n                    <span class="insight-text">${e.trim()}</span>\n                </div>\n            `:i.slice(0,5).map(e=>`\n            <div class="insight-item">\n                <span class="insight-bullet">${"risk"===t?"⚠️":"✅"}</span>\n                <span class="insight-text">${e.trim().replace(/\.$/,"")}${e.trim().endsWith(".")?"":"."}</span>\n            </div>\n        `).join("")}formatAnalysisText(e){return e?e.split(/\n\n+/).filter(e=>e.trim().length>0).map(e=>`<p>${e.trim()}</p>`).join(""):"<p>Keine Analyse verfügbar</p>"}initializeCharts(e){this.createFundamentalRadarChart(e),this.createRiskOpportunityChart(e)}createFundamentalRadarChart(e){const t=document.getElementById("fundamentalRadarChart");if(!t)return;const i=t.getContext("2d");this.radarChart&&this.radarChart.destroy();const a={Wert:this.extractValueScore(e),Wachstum:this.extractGrowthScore(e),Qualität:this.extractQualityScore(e),Momentum:this.extractMomentumScore(e),Liquidität:this.extractLiquidityScore(e)};this.radarChart=new Chart(i,{type:"radar",data:{labels:Object.keys(a),datasets:[{label:"Fundamental-Score",data:Object.values(a),backgroundColor:"rgba(59, 130, 246, 0.2)",borderColor:"rgba(59, 130, 246, 1)",borderWidth:2,pointBackgroundColor:"rgba(59, 130, 246, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgba(59, 130, 246, 1)"}]},options:{responsive:!0,maintainAspectRatio:!0,scales:{r:{beginAtZero:!0,max:100,ticks:{stepSize:20,color:"#9ca3af"},grid:{color:"#374151"},pointLabels:{color:"#d1d5db",font:{size:12}}}},plugins:{legend:{display:!1}}}})}createRiskOpportunityChart(e){const t=document.getElementById("riskOpportunityChart");if(!t)return;const i=t.getContext("2d");this.riskChart&&this.riskChart.destroy();const a=this.countInsights(e.ai_analysis?.risks),s=this.countInsights(e.ai_analysis?.opportunities);this.riskChart=new Chart(i,{type:"bar",data:{labels:["Risiken","Chancen"],datasets:[{label:"Anzahl",data:[a,s],backgroundColor:["rgba(239, 68, 68, 0.8)","rgba(34, 197, 94, 0.8)"],borderColor:["rgba(239, 68, 68, 1)","rgba(34, 197, 94, 1)"],borderWidth:2}]},options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",scales:{x:{beginAtZero:!0,ticks:{stepSize:1,color:"#9ca3af"},grid:{color:"#374151"}},y:{ticks:{color:"#d1d5db"},grid:{display:!1}}},plugins:{legend:{display:!1}}}})}extractTechnicalScore(e){const t=e.ai_analysis?.technical_analysis?.toLowerCase()||"";return t.includes("strong")||t.includes("bullish")?75:t.includes("weak")||t.includes("bearish")?35:50}extractFundamentalScore(e){const t=(e.ai_analysis?.fundamental_analysis?.toLowerCase()||"").match(/overall.*?(\d+)/i);return t?parseInt(t[1]):50}extractValueScore(e){const t=(e.ai_analysis?.fundamental_analysis?.toLowerCase()||"").match(/value.*?(\d+)/i);return t?parseInt(t[1]):50}extractGrowthScore(e){const t=e.ai_analysis?.fundamental_analysis?.toLowerCase()||"";return t.includes("growth")&&t.includes("strong")?70:t.includes("growth")&&t.includes("weak")?30:50}extractQualityScore(e){const t=(e.ai_analysis?.fundamental_analysis?.toLowerCase()||"").match(/health.*?(\d+)/i);return t?parseInt(t[1]):50}extractMomentumScore(e){const t=(e.ai_analysis?.technical_analysis?.toLowerCase()||"").match(/rsi.*?(\d+\.?\d*)/i);if(t){const e=parseFloat(t[1]);return Math.min(100,e)}return 50}extractLiquidityScore(e){const t=e.ai_analysis?.fundamental_analysis?.toLowerCase()||"";return t.includes("liquidity")&&t.includes("strong")?80:t.includes("liquidity")&&t.includes("weak")?30:60}countInsights(e){return e?e.split(/\d+\.\s+|\*\s+|\-\s+/).filter(e=>e.trim().length>10).length||e.split(/\.\s+/).filter(e=>e.trim().length>20).length:0}generateErrorHTML(){return'\n            <div class="ai-error-container">\n                <div class="error-icon">⚠️</div>\n                <h3>KI-Analyse nicht verfügbar</h3>\n                <p>Die KI-Analyse konnte nicht durchgeführt werden. Bitte überprüfen Sie Ihre API-Konfiguration.</p>\n            </div>\n        '}generateSqueezeScenariosCard(e){if(!e.squeeze_analysis||!e.squeeze_analysis.price_scenarios)return"";const t=e.squeeze_analysis,i=t.price_scenarios.scenarios,a=t.price_scenarios.current_price,s=t.price_scenarios.warning;return i&&0!==i.length?`\n            <div class="ai-card squeeze-scenarios-card">\n                <h4>🎯 Short Squeeze Kursziel-Szenarien</h4>\n\n                <div class="squeeze-warning">\n                    ${s}\n                </div>\n\n                <div class="current-price-display">\n                    <span class="label">Aktueller Kurs:</span>\n                    <span class="price">$${a.toFixed(2)}</span>\n                </div>\n\n                <div class="scenarios-grid">\n                    ${i.map((e,t)=>`\n                        <div class="scenario-card ${0===t?"conservative":1===t?"base":"aggressive"}">\n                            <div class="scenario-header">\n                                <span class="scenario-name">${e.name}</span>\n                                <span class="scenario-probability">${e.probability}</span>\n                            </div>\n\n                            <div class="scenario-target">\n                                <div class="target-price">$${e.target_price.toFixed(2)}</div>\n                                <div class="target-upside ${e.upside_percent>0?"positive":"negative"}">\n                                    ${e.upside_percent>0?"+":""}${e.upside_percent.toFixed(1)}%\n                                </div>\n                            </div>\n\n                            <div class="scenario-timeframe">\n                                <i class="clock-icon">⏰</i> ${e.timeframe}\n                            </div>\n\n                            <div class="scenario-description">\n                                ${e.description}\n                            </div>\n\n                            <div class="scenario-triggers">\n                                <div class="triggers-label">Auslöser:</div>\n                                <ul>\n                                    ${e.triggers.map(e=>`<li>${e}</li>`).join("")}\n                                </ul>\n                            </div>\n                        </div>\n                    `).join("")}\n                </div>\n\n                <div class="squeeze-score-summary">\n                    <div class="score-label">Squeeze Score:</div>\n                    <div class="score-bar">\n                        <div class="score-fill" style="width: ${t.score}%">\n                            ${t.score}/100\n                        </div>\n                    </div>\n                    <div class="score-level ${t.level.toLowerCase()}">\n                        ${t.level} - ${t.description}\n                    </div>\n                </div>\n\n                <div class="methodology-note">\n                    <i>ℹ️ ${t.price_scenarios.methodology}</i>\n                </div>\n            </div>\n        `:""}async loadTechnicalChart(e){try{const t=await fetch(`/api/stock/${e}/history?period=6mo`),i=await t.json();if(!i.data||0===i.data.length)return void console.error("No price data available for technical chart");this.priceData=i.data,this.renderTechnicalChart()}catch(e){console.error("Error loading technical chart:",e)}}renderTechnicalChart(){const e=document.getElementById("aiTechnicalChart");if(!e||!this.priceData)return;this.technicalChart&&this.technicalChart.destroy();const t=e.getContext("2d"),i=this.priceData.map(e=>e.date),a=this.priceData.map(e=>e.close),s=[{label:`${this.currentTicker} Preis`,data:a,borderColor:"rgb(102, 126, 234)",backgroundColor:"rgba(102, 126, 234, 0.1)",borderWidth:2,fill:!0,tension:.1,pointRadius:0,pointHoverRadius:4}];if(this.showSMA50){const e=this.calculateSMA(a,50);s.push({label:"SMA 50",data:e,borderColor:"rgb(72, 187, 120)",backgroundColor:"transparent",borderWidth:2,fill:!1,tension:.1,pointRadius:0})}if(this.showSMA200){const e=this.calculateSMA(a,200);s.push({label:"SMA 200",data:e,borderColor:"rgb(245, 101, 101)",backgroundColor:"transparent",borderWidth:2,fill:!1,tension:.1,pointRadius:0})}if(this.showBB){const e=this.calculateBollingerBands(a,20,2);s.push({label:"BB Upper",data:e.upper,borderColor:"rgba(128, 128, 128, 0.5)",backgroundColor:"transparent",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0}),s.push({label:"BB Lower",data:e.lower,borderColor:"rgba(128, 128, 128, 0.5)",backgroundColor:"transparent",borderWidth:1,borderDash:[5,5],fill:!1,pointRadius:0})}this.technicalChart=new Chart(t,{type:"line",data:{labels:i,datasets:s},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,position:"top"},tooltip:{enabled:!0,mode:"index",intersect:!1}},scales:{x:{display:!0,title:{display:!0,text:"Datum"}},y:{display:!0,title:{display:!0,text:"Preis ($)"},beginAtZero:!1}}}})}toggleChartIndicator(e,t){switch(e){case"sma50":this.showSMA50=t;break;case"sma200":this.showSMA200=t;break;case"bb":this.showBB=t}this.renderTechnicalChart()}calculateSMA(e,t){const i=[];for(let a=0;a<e.length;a++)if(a<t-1)i.push(null);else{const s=e.slice(a-t+1,a+1).reduce((e,t)=>e+t,0);i.push(s/t)}return i}calculateBollingerBands(e,t,i){const a=this.calculateSMA(e,t),s=[],n=[];for(let r=0;r<e.length;r++)if(r<t-1)s.push(null),n.push(null);else{const o=e.slice(r-t+1,r+1),l=a[r],c=o.reduce((e,t)=>e+Math.pow(t-l,2),0)/t,d=Math.sqrt(c);s.push(l+d*i),n.push(l-d*i)}return{upper:s,middle:a,lower:n}}};